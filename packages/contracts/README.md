# Basecred Contracts (Foundry)

This package contains the on-chain verifier and decision registry contracts for Basecred.

## Quickstart

- Install Foundry: https://book.getfoundry.sh/getting-started/installation
- Install forge-std: `forge install foundry-rs/forge-std`
- Install circuit tooling: `pnpm -C packages/contracts install`
- Install Circom compiler and ensure `circom` is on PATH (required for `circuit:build`).
- Build: `forge build`
- Test: `forge test`

## Generate Groth16 Verifier (snarkjs)

Replace the placeholder verifier with the Groth16 verifier generated by snarkjs:

```bash
snarkjs zkey export solidityverifier circuit_final.zkey Verifier.sol
```

Then move `Verifier.sol` into `packages/contracts/contracts/`.

## Circuits

See `packages/contracts/circuits/CIRCUIT_SPEC.md` for encodings and rule order.
Use the package scripts:

```bash
pnpm -C packages/contracts circuit:build
pnpm -C packages/contracts circuit:setup
pnpm -C packages/contracts circuit:contribute
pnpm -C packages/contracts circuit:verifier
```

## Deployment (Base)

```bash
forge script scripts/Deploy.s.sol \
  --rpc-url $BASE_RPC_URL \
  --broadcast \
  --private-key $DEPLOYER_PRIVATE_KEY
```

Set:
- `BASE_RPC_URL`
- `DEPLOYER_PRIVATE_KEY`

### Base Sepolia (84532)

- Verifier: `0x14E91Bb6d25A24E4201B4A32E11F1D3807a4d08c`
- DecisionRegistry: `0x5a74Fe2909Bf59D0361DbE329c6dB6F705165F86`

## Contracts

- `contracts/Verifier.sol`
  - Placeholder verifier contract. Replace with the Groth16 verifier generated by snarkjs.
- `contracts/DecisionRegistry.sol`
  - Stores decision metadata keyed by `subjectHash + context + policyHash`.
  - Verifies Groth16 proofs via the verifier contract.
  - Emits `DecisionSubmitted` events.

## Notes

- Public signal layout is assumed to be `[policyHash, contextHash?]`. Update `DecisionRegistry.sol` to match the circuit.
- On-chain storage must never include raw scores or profile data.
